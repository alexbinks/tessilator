
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tessilator.lc_analysis &#8212; tessilator 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pyramid.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">tessilator 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">tessilator.lc_analysis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tessilator.lc_analysis</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Alexander Binks &amp; Moritz Guenther, January 2023</span>

<span class="sd">Licence: MIT 2023</span>

<span class="sd">This module contains functions which are called upon by either the tess_cutouts.py</span>
<span class="sd">or tess_large_sectors.py modules. These are:</span>

<span class="sd">1)  aper_run - returns a numpy array containing the times, magnitudes and</span>
<span class="sd">    fluxes from aperture photometry.</span>
<span class="sd">    </span>
<span class="sd">2)  clean_lc/detrend_lc/make_lc - these 3 functions are made to remove spurious data</span>
<span class="sd">    points, ensure that only &quot;strings&quot; of contiguous data are being processed, and</span>
<span class="sd">    each string is detrended using either a linear (1st) or quadratic (2nd) polynomial</span>
<span class="sd">    (chosen by Aikake Inference Criterion) using only data contained in each string.</span>
<span class="sd">    Finally, the lightcurve is pieced together and make_lc returns a table containing</span>
<span class="sd">    the data ready for periodogram analysis.</span>
<span class="sd">    </span>
<span class="sd">3)  run_LS - function to conduct Lomb-Scargle periodogram analysis. Returns a table</span>
<span class="sd">    with period measurements, plus several data quality flags. If required a plot of</span>
<span class="sd">    the lightcurve, periodogram and phase-folded lightcurve is provided.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.timeseries</span> <span class="kn">import</span> <span class="n">LombScargle</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>

<span class="kn">from</span> <span class="nn">photutils.aperture</span> <span class="kn">import</span> <span class="n">CircularAperture</span><span class="p">,</span> <span class="n">CircularAnnulus</span>
<span class="kn">from</span> <span class="nn">photutils.aperture</span> <span class="kn">import</span> <span class="n">aperture_photometry</span><span class="p">,</span> <span class="n">ApertureStats</span>
<span class="kn">from</span> <span class="nn">astroquery.gaia</span> <span class="kn">import</span> <span class="n">Gaia</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Tesscut</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">median_abs_deviation</span> <span class="k">as</span> <span class="n">MAD</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># Local application imports</span>
<span class="kn">from</span> <span class="nn">.tess_stars2px</span> <span class="kn">import</span> <span class="n">tess_stars2px_function_entry</span>
<span class="kn">from</span> <span class="nn">.fixedconstants</span> <span class="kn">import</span> <span class="o">*</span>



<span class="c1"># initialize the logger object</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger_aq</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;astroquery&quot;</span><span class="p">)</span>
<span class="n">logger_aq</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>    
    



<div class="viewcode-block" id="get_xy_pos"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.get_xy_pos.html#tessilator.lc_analysis.get_xy_pos">[docs]</a><span class="k">def</span> <span class="nf">get_xy_pos</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">head</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Locate the X-Y position for targets in a given Sector/CCD/Camera mode</span>
<span class="sd">    </span>
<span class="sd">    .. _astropy.table.Table: https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.timeseries.Table</span>
<span class="sd">    .. |astropy.table.Table| replace:: **astropy.table.Table** </span>
<span class="sd">    .. _astropy.io.fits: https://docs.astropy.org/en/stable/io/fits/index.html</span>
<span class="sd">    .. |astropy.io.fits| replace:: **astropy.io.fits**</span>
<span class="sd">    .. _tuple: https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences</span>
<span class="sd">    .. |tuple| replace:: **tuple**</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    targets : |astropy.table.Table|_</span>
<span class="sd">        The table of input data with celestial coordinates.</span>
<span class="sd">    head : |astropy.io.fits|_</span>
<span class="sd">        The fits header containing the WCS coordinate details.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    positions : |tuple|_</span>
<span class="sd">        A tuple of X-Y pixel positions for each target.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">],</span> <span class="n">targets</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_obj</span><span class="p">,</span> <span class="n">x_obj</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">world_to_array_index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get the WCS coordinates to work...&quot;</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;Xpos&quot;</span><span class="p">],</span> <span class="n">targets</span><span class="p">[</span><span class="s2">&quot;Ypos&quot;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">positions</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_obj</span><span class="p">,</span> <span class="n">y_obj</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">positions</span></div>



<div class="viewcode-block" id="aper_run"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.aper_run.html#tessilator.lc_analysis.aper_run">[docs]</a><span class="k">def</span> <span class="nf">aper_run</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">Rad</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">SkyRad</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">8.</span><span class="p">],</span> <span class="n">XY_pos</span><span class="o">=</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Perform aperture photometry for the image data.</span>

<span class="sd">    .. _str: https://docs.python.org/3/library/stdtypes.html#str</span>
<span class="sd">    .. |str| replace:: **str**</span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _tuple: https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences</span>
<span class="sd">    .. |tuple| replace:: **tuple**</span>
<span class="sd">    .. _astropy.table.Table: https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.timeseries.Table</span>
<span class="sd">    .. |astropy.table.Table| replace:: **astropy.table.Table** </span>

<span class="sd">    This function reads in each fits file, and performs aperture photometry.</span>
<span class="sd">    A table of aperture photometry results is returned, which forms the raw</span>
<span class="sd">    lightcurve to be processed in subsequent functions.</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_in : |str|_</span>
<span class="sd">        Name of the fits file containing image data</span>
<span class="sd">    targets : |astropy.table.Table|_</span>
<span class="sd">        The table of input data</span>
<span class="sd">    Rad : |float|_, optional, default=1.</span>
<span class="sd">        The pixel radius to define the circular area for the aperture</span>
<span class="sd">    SkyRad : |tuple|_, optional, default=(6.,8.)</span>
<span class="sd">        A 2-element tuple defining the inner and outer annulus to calculate</span>
<span class="sd">        the background flux</span>
<span class="sd">    XY_pos : |tuple|_, optional, default=(10.,10.)</span>
<span class="sd">        The X-Y centroid (in pixels) of the aperture.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    full_phot_table : |astropy.table.Table|_</span>
<span class="sd">        The formatted table containing results from the aperture photometry.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">fits_files</span> <span class="o">=</span> <span class="n">file_in</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fits_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_in</span><span class="p">]</span>

    <span class="n">full_phot_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;xcenter&#39;</span><span class="p">,</span> <span class="s1">&#39;ycenter&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;flux_err&#39;</span><span class="p">,</span> <span class="s1">&#39;bkg&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bkg&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;flux_corr&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_err&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span>
                                   <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">f_num</span><span class="p">,</span> <span class="n">f_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fits_files</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">n_steps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
                    <span class="n">qual_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;QUALITY&quot;</span><span class="p">]</span>
                    <span class="n">time_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span>
                    <span class="n">flux_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span>
                    <span class="n">erro_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX_ERR&quot;</span><span class="p">]</span>
                    <span class="n">positions</span> <span class="o">=</span> <span class="n">XY_pos</span>
                <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
                    <span class="n">qual_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">head</span><span class="p">[</span><span class="s2">&quot;DQUALITY&quot;</span><span class="p">]]</span>
                    <span class="n">time_val</span> <span class="o">=</span> <span class="p">[(</span><span class="n">head</span><span class="p">[</span><span class="s1">&#39;TSTART&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">head</span><span class="p">[</span><span class="s1">&#39;TSTOP&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">]</span>
                    <span class="n">flux_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
                    <span class="n">erro_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">hdul</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
                    <span class="n">positions</span> <span class="o">=</span> <span class="n">get_xy_pos</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n_step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">qual_val</span><span class="p">[</span><span class="n">n_step</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1">#define a circular aperture around all objects</span>
                        <span class="n">aperture</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">Rad</span><span class="p">)</span>
                        <span class="c1">#select a background annulus</span>
                        <span class="n">annulus_aperture</span> <span class="o">=</span> <span class="n">CircularAnnulus</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span>
                                                           <span class="n">SkyRad</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">SkyRad</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="c1">#get the image statistics for the background annulus</span>
                        <span class="n">aperstats</span> <span class="o">=</span> <span class="n">ApertureStats</span><span class="p">(</span><span class="n">flux_vals</span><span class="p">[:][:][</span><span class="n">n_step</span><span class="p">],</span>
                                                  <span class="n">annulus_aperture</span><span class="p">)</span>
                        <span class="c1">#obtain the raw (source+background) flux</span>
                        <span class="n">phot_table</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span>
                                     <span class="n">flux_vals</span><span class="p">[:][:][</span><span class="n">n_step</span><span class="p">],</span> <span class="n">aperture</span><span class="p">,</span>
                                     <span class="n">error</span><span class="o">=</span><span class="n">erro_vals</span><span class="p">[:][:][</span><span class="n">n_step</span><span class="p">])</span>
                        <span class="c1">#calculate the background contribution to the aperture</span>
                        <span class="n">aperture_area</span> <span class="o">=</span> <span class="n">aperture</span><span class="o">.</span><span class="n">area_overlap</span><span class="p">(</span>
                                        <span class="n">flux_vals</span><span class="p">[:][:][</span><span class="n">n_step</span><span class="p">])</span>
                        <span class="c1">#print out the data to &quot;phot_table&quot;</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">]</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;bkg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aperstats</span><span class="o">.</span><span class="n">median</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;total_bkg&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;bkg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">aperture_area</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;aperture_sum_bkgsub&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;aperture_sum&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;total_bkg&#39;</span><span class="p">]</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                                  <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
                            <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                                <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;aperture_sum_bkgsub&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">Zpt</span>
                            <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;mag_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="o">-</span><span class="mf">2.5</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">*</span>\
                                <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;aperture_sum_err&#39;</span><span class="p">]</span><span class="o">/</span>\
                                <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;aperture_sum&#39;</span><span class="p">])</span>
                        <span class="n">phot_table</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_val</span><span class="p">[</span><span class="n">n_step</span><span class="p">]</span>
                        <span class="n">fix_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;xcenter&#39;</span><span class="p">,</span> <span class="s1">&#39;ycenter&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;aperture_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;aperture_sum_err&#39;</span><span class="p">,</span> <span class="s1">&#39;bkg&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;total_bkg&#39;</span><span class="p">,</span> <span class="s1">&#39;aperture_sum_bkgsub&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;mag_err&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]</span>
                        <span class="n">phot_table</span> <span class="o">=</span> <span class="n">phot_table</span><span class="p">[</span><span class="n">fix_cols</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phot_table</span><span class="p">)):</span>
                            <span class="n">full_phot_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is a problem opening the file </span><span class="si">{</span><span class="n">f_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is a problem opening the file </span><span class="si">{</span><span class="n">f_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
    <span class="k">return</span> <span class="n">full_phot_table</span></div>




<div class="viewcode-block" id="clean_lc"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.clean_lc.html#tessilator.lc_analysis.clean_lc">[docs]</a><span class="k">def</span> <span class="nf">clean_lc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">MAD_fac</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">time_fac</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">min_num_per_group</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Remove data points from the lightcurve that are likely to be spurious.</span>

<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _int: https://docs.python.org/3/library/functions.html#int</span>
<span class="sd">    .. |int| replace:: **int** </span>
<span class="sd">    .. _list: https://docs.python.org/3/tutorial/datastructures.html</span>
<span class="sd">    .. |list| replace:: **list**</span>

<span class="sd">    Many lightcurves have a 1 or 2 day gap. To avoid systematic offsets and</span>
<span class="sd">    ensure the data is efficiently normalized, the lightcurve is split into</span>
<span class="sd">    &quot;strings&quot; of contiguous data. Neighbouring data points must have been</span>
<span class="sd">    observed within 10 times the median absolute deviation of the time</span>
<span class="sd">    difference between each observation.</span>
<span class="sd">    </span>
<span class="sd">    The start and end point of each data section must have a flux value within</span>
<span class="sd">    a given number of MAD from the median flux in the sector. This is done</span>
<span class="sd">    because often after large time gaps the temperature of the sensors changes,</span>
<span class="sd">    and including these components is likely to just result in a signal from</span>
<span class="sd">    instrumental noise.</span>
<span class="sd">    </span>
<span class="sd">    The function returns the start and end points for each data section in the</span>
<span class="sd">    sector, which must contain a chosen number of data points. This is to</span>
<span class="sd">    ensure there are enough datapoints to construct a periodogram analysis.</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : |Iterable|_</span>
<span class="sd">        The set of time coordinates (in days)</span>
<span class="sd">    f : |Iterable|_</span>
<span class="sd">        The set of normalised flux coordinates</span>
<span class="sd">    MAD_fac : |float|_, optional, default=2.</span>
<span class="sd">        The threshold number of MAD values to allow. </span>
<span class="sd">    time_fac : |float|_, optional, default=10.</span>
<span class="sd">        The maximum time gap allowed between neighbouring datapoints.</span>
<span class="sd">    min_num_per_group : |int|_, optional, default=50</span>
<span class="sd">        The minimum number of datapoints allowed in a contiguous set.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    start_index : |list|_</span>
<span class="sd">       The start indices for each saved data string.</span>
<span class="sd">    end_index : |list|_</span>
<span class="sd">       The end indices for each saved data string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">tm</span><span class="p">,</span> <span class="n">fm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">f_MAD</span>  <span class="o">=</span> <span class="n">MAD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">td</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">td</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fm</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">MAD_fac</span><span class="o">*</span><span class="n">f_MAD</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">td</span> <span class="o">&lt;=</span> <span class="n">time_fac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">td</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">B</span>  <span class="o">=</span> <span class="p">(</span><span class="n">A0</span><span class="o">+</span><span class="n">A1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">gs</span><span class="p">,</span> <span class="n">gf</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>    
    <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">A1</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">while</span> <span class="n">A0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    
    <span class="n">gs</span><span class="p">,</span> <span class="n">gf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gf</span><span class="p">)</span>
    <span class="n">start_index</span> <span class="o">=</span> <span class="n">gs</span><span class="p">[(</span><span class="n">gf</span><span class="o">-</span><span class="n">gs</span><span class="p">)</span><span class="o">&gt;</span><span class="n">min_num_per_group</span><span class="p">]</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">gf</span><span class="p">[(</span><span class="n">gf</span><span class="o">-</span><span class="n">gs</span><span class="p">)</span><span class="o">&gt;</span><span class="n">min_num_per_group</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span></div>



<div class="viewcode-block" id="detrend_lc"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.detrend_lc.html#tessilator.lc_analysis.detrend_lc">[docs]</a><span class="k">def</span> <span class="nf">detrend_lc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">err</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Detrend and normalise the lightcurves.</span>

<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _dict: https://docs.python.org/3/tutorial/datastructures.html#dictionaries</span>
<span class="sd">    .. |dict| replace:: **dict**</span>


<span class="sd">    This function operates on each section of data returned from the &quot;clean_lc&quot;</span>
<span class="sd">    function and performs a detrending routine so that data from separate</span>
<span class="sd">    sections can be connected. Five lists are outputted which form the</span>
<span class="sd">    normalized, detrended lightcurve.</span>
<span class="sd">    </span>
<span class="sd">    The choice of polynomial fit for the detrending function is linear or</span>
<span class="sd">    quadratic, and depends on which component best satisfies the Aikake</span>
<span class="sd">    Information Criterion.</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : |Iterable|_</span>
<span class="sd">        the start indices for the lightcurve.</span>
<span class="sd">    df : |Iterable|_</span>
<span class="sd">        the end indices for the lightcurve.</span>
<span class="sd">    t : |Iterable|_</span>
<span class="sd">        The list of time coordinates.</span>
<span class="sd">    f : |Iterable|_</span>
<span class="sd">        The list of flux coordinates.</span>
<span class="sd">    err : |Iterable|_</span>
<span class="sd">        The list of flux error coordinates.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict_lc : |dict|_</span>
<span class="sd">        | A dictionary containing the following keys:</span>
<span class="sd">        | &quot;time&quot; -&gt; The time coordinate</span>
<span class="sd">        | &quot;oflux&quot; -&gt; The original, normalised flux values</span>
<span class="sd">        | &quot;nflux&quot; -&gt; The detrended, cleaned, normalised flux values</span>
<span class="sd">        | &quot;enflux&quot; -&gt; The error on &quot;nflux&quot;</span>
<span class="sd">        | &quot;polyord&quot; -&gt; The polynomial order used for each detrend        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dict_lc</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:[],</span> <span class="s2">&quot;oflux&quot;</span><span class="p">:[],</span> <span class="s2">&quot;nflux&quot;</span><span class="p">:[],</span> <span class="s2">&quot;enflux&quot;</span><span class="p">:[],</span> <span class="s2">&quot;polyord&quot;</span><span class="p">:[]}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)):</span>
        <span class="n">rs</span><span class="p">,</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">t_orig</span><span class="p">,</span> <span class="n">f_orig</span><span class="p">,</span> <span class="n">e_orig</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">rs</span><span class="p">:</span><span class="n">rf</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">rs</span><span class="p">:</span><span class="n">rf</span><span class="p">],</span> <span class="n">err</span><span class="p">[</span><span class="n">rs</span><span class="p">:</span><span class="n">rf</span><span class="p">]</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">t_orig</span><span class="p">,</span> <span class="n">f_orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">p2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">t_orig</span><span class="p">,</span> <span class="n">f_orig</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">t_orig</span><span class="o">-</span><span class="n">f_orig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">e_orig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">t_orig</span><span class="o">-</span><span class="n">f_orig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">e_orig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">AIC1</span><span class="p">,</span> <span class="n">AIC2</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">chi1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">chi2</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">AIC1</span> <span class="o">&lt;</span> <span class="n">AIC2</span><span class="p">:</span>
            <span class="n">f_n</span> <span class="o">=</span> <span class="n">f_orig</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">t_orig</span><span class="p">)</span>
            <span class="n">s_fit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_n</span> <span class="o">=</span> <span class="n">f_orig</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">t_orig</span><span class="p">)</span>
            <span class="n">s_fit</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_orig</span><span class="p">)):</span>
            <span class="n">dict_lc</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_orig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">dict_lc</span><span class="p">[</span><span class="s2">&quot;oflux&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_orig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">dict_lc</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_n</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">dict_lc</span><span class="p">[</span><span class="s2">&quot;enflux&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_orig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">dict_lc</span><span class="p">[</span><span class="s2">&quot;polyord&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_fit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_lc</span></div>


<div class="viewcode-block" id="make_lc"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.make_lc.html#tessilator.lc_analysis.make_lc">[docs]</a><span class="k">def</span> <span class="nf">make_lc</span><span class="p">(</span><span class="n">phot_table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Construct the normalised TESS lightcurve.</span>
<span class="sd">    </span>
<span class="sd">    .. _astropy.table.Table: https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.timeseries.Table</span>
<span class="sd">    .. |astropy.table.Table| replace:: **astropy.table.Table** </span>
<span class="sd">    .. _dict: https://docs.python.org/3/tutorial/datastructures.html#dictionaries</span>
<span class="sd">    .. |dict| replace:: **dict**</span>

<span class="sd">    | The function runs the following tasks:</span>
<span class="sd">    | (1) Read the table produced from the aperture photometry</span>
<span class="sd">    | (2) Normalise the lightcurve using the median flux value.</span>
<span class="sd">    | (3) Clean the lightcurve from spurious data using &quot;clean_lc&quot;</span>
<span class="sd">    | (4) Detrend the lightcurve using &quot;detrend_lc&quot;</span>
<span class="sd">    | (5) Return the original normalised lightcurve and the cleaned lightcurve</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    phot_table : |astropy.table.Table|_ or |dict|_</span>
<span class="sd">        | The data table containing aperture photometry returned by aper_run.py. Columns must include:</span>
<span class="sd">        | &quot;time&quot; -&gt; The time coordinate for each image</span>
<span class="sd">        | &quot;mag&quot; -&gt; The target magnitude</span>
<span class="sd">        | &quot;flux_corr&quot; -&gt; The total flux subtracted by the background flux</span>
<span class="sd">        | &quot;flux_err&quot; -&gt; The error on flux_corr</span>
<span class="sd">        </span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    cln : |dict|_</span>
<span class="sd">        | The cleaned, detrended, normalised lightcurve, with the keys:</span>
<span class="sd">        | &quot;time&quot; -&gt; The time coordinate</span>
<span class="sd">        | &quot;time0&quot; -&gt; The time coordinate relative to the first data point</span>
<span class="sd">        | &quot;oflux&quot; -&gt; The original, normalised flux values</span>
<span class="sd">        | &quot;nflux&quot; -&gt; The detrended, cleaned, normalised flux values</span>
<span class="sd">        | &quot;enflux&quot; -&gt; The error on &quot;nflux&quot;</span>
<span class="sd">        | &quot;polyord&quot; -&gt; The polynomial order used for each detrend        </span>

<span class="sd">    orig : |dict|_</span>
<span class="sd">        | The original, normalised lightcurve, with the keys:</span>
<span class="sd">        | &quot;time&quot; -&gt; The time coordinate</span>
<span class="sd">        | &quot;nflux&quot; -&gt; The original, normalised flux values</span>
<span class="sd">        | &quot;mag&quot; -&gt; The TESS magnitude values</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">m_diff</span> <span class="o">=</span> <span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;flux_corr&quot;</span><span class="p">][:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;flux_corr&quot;</span><span class="p">][:])</span>
    <span class="n">m_thr</span> <span class="o">=</span> <span class="mf">20.0</span><span class="o">*</span><span class="n">MAD</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;flux_corr&quot;</span><span class="p">][:],</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m_diff</span> <span class="o">&lt;</span> <span class="n">m_thr</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][:][</span><span class="n">g</span><span class="p">])</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">][:][</span><span class="n">g</span><span class="p">])</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;flux_corr&quot;</span><span class="p">][:][</span><span class="n">g</span><span class="p">])</span>
    <span class="n">eflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phot_table</span><span class="p">[</span><span class="s2">&quot;flux_err&quot;</span><span class="p">][:][</span><span class="n">g</span><span class="p">])</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">clean_lc</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span><span class="c1"># [], []</span>
    <span class="c1"># 1st: normalise the flux by dividing by the median value</span>
    <span class="n">nflux</span>  <span class="o">=</span> <span class="n">flux</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">neflux</span> <span class="o">=</span> <span class="n">eflux</span><span class="o">/</span><span class="n">flux</span>
    <span class="c1"># 2nd: detrend each lightcurve sections by either a straight-line fit or a</span>
    <span class="c1"># parabola. The choice is selected using AIC.</span>
    <span class="n">cln</span> <span class="o">=</span> <span class="n">detrend_lc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">nflux</span><span class="p">,</span> <span class="n">neflux</span><span class="p">)</span>
    <span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]))]</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">orig</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">orig</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nflux</span><span class="p">)</span>
    <span class="n">orig</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cln</span><span class="p">,</span> <span class="n">orig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="c1"># [], []</span></div>



<div class="viewcode-block" id="get_second_peak"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.get_second_peak.html#tessilator.lc_analysis.get_second_peak">[docs]</a><span class="k">def</span> <span class="nf">get_second_peak</span><span class="p">(</span><span class="n">power</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;An algorithm to identify the second-highest peak in the periodogram</span>
<span class="sd">    </span>
<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _list: https://docs.python.org/3/tutorial/datastructures.html</span>
<span class="sd">    .. |list| replace:: **list**</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    power : |Iterable|_</span>
<span class="sd">        A set of power values calculated from the periodogram analysis.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    a_g : |list|_</span>
<span class="sd">        A list of indices corresponding to the Gaussian around the peak power.</span>
<span class="sd">    a_o : |list|_</span>
<span class="sd">        A list of indices corresponding to all other parts of the periodogram.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get the left side of the peak</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>

    <span class="n">p_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">p_m</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">power</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">p_l</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">p_lx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">p_l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.85</span><span class="o">*</span><span class="n">power</span><span class="p">[</span><span class="n">p_m</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p_l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">p_lx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p_l</span> <span class="o">=</span> <span class="n">p_l</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">p_lx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">p_l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">power</span><span class="p">[</span><span class="n">p_l</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p_l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">p_l</span> <span class="o">=</span> <span class="n">p_l</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">p_l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p_l</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get the right side of the peak</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">p_m</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">power</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">p_r</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">p_rx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">p_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.85</span><span class="o">*</span><span class="n">power</span><span class="p">[</span><span class="n">p_m</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p_r</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">p_rx</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">p_r</span> <span class="o">=</span> <span class="n">p_r</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">p_rx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
           <span class="k">while</span> <span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">p_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">power</span><span class="p">[</span><span class="n">p_r</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p_r</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">p_r</span> <span class="o">=</span> <span class="n">p_r</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">p_r</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">p_r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">a_g</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">p_l</span><span class="p">:</span><span class="n">p_r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">a_o</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">a_g</span><span class="p">)]</span> 
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">a_g</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">a_o</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">x</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a_g</span><span class="p">,</span> <span class="n">a_o</span></div>


<div class="viewcode-block" id="filter_out_none"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.filter_out_none.html#tessilator.lc_analysis.filter_out_none">[docs]</a><span class="k">def</span> <span class="nf">filter_out_none</span><span class="p">(</span><span class="n">unfiltered</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Simple function to remove list items if they are empty.</span>

<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _list: https://docs.python.org/3/tutorial/datastructures.html</span>
<span class="sd">    .. |list| replace:: **list**</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    unfiltered : |Iterable|_</span>
<span class="sd">        The input set of values</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    filtered : |list|_</span>
<span class="sd">        The filtered list.</span>

<span class="sd">    &gt;&gt;&gt; filter_out_none([1, 4, None, 6, 9])</span>
<span class="sd">    [1, 4, 6, 9]</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">filtered</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unfiltered</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">filtered</span></div>


<div class="viewcode-block" id="gauss_fit"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.gauss_fit.html#tessilator.lc_analysis.gauss_fit">[docs]</a><span class="k">def</span> <span class="nf">gauss_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Construct a simple Gaussian.</span>
<span class="sd">    </span>
<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _list: https://docs.python.org/3/tutorial/datastructures.html</span>
<span class="sd">    .. |list| replace:: **list**</span>

<span class="sd">    Return Gaussian values from a given amplitude (a0), mean (x_mean) and</span>
<span class="sd">    uncertainty (sigma) for a distribution of values</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : |Iterable|_</span>
<span class="sd">        list of input values</span>
<span class="sd">    a0 : |float|_</span>
<span class="sd">        Amplitude of a Gaussian</span>
<span class="sd">    x_mean : |float|_</span>
<span class="sd">        The mean value of a Gaussian</span>
<span class="sd">    sigma : |float|_</span>
<span class="sd">        The Gaussian uncertainty</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    gaussian : |list|_</span>
<span class="sd">        A list of Gaussian values.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">gaussian</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">gaussian</span></div>

<div class="viewcode-block" id="sine_fit"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.sine_fit.html#tessilator.lc_analysis.sine_fit">[docs]</a><span class="k">def</span> <span class="nf">sine_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the best parameters (y_offset, amplitude, and phase) to a regular</span>
<span class="sd">    sinusoidal function.</span>

<span class="sd">    .. _Iterable: https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable</span>
<span class="sd">    .. |Iterable| replace:: **Iterable** </span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _list: https://docs.python.org/3/tutorial/datastructures.html</span>
<span class="sd">    .. |list| replace:: **list**</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : |Iterable|_</span>
<span class="sd">        list of input values</span>
<span class="sd">    y0 : |float|_</span>
<span class="sd">        The midpoint of the sine curve</span>
<span class="sd">    A : |float|_</span>
<span class="sd">        The amplitude of the sine curve</span>
<span class="sd">    phi : |float|_</span>
<span class="sd">        The phase angle of the sine curve</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    sine : |list|_</span>
<span class="sd">        A list of sine curve values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sine</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sine</span></div>


<div class="viewcode-block" id="run_ls"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.run_ls.html#tessilator.lc_analysis.run_ls">[docs]</a><span class="k">def</span> <span class="nf">run_ls</span><span class="p">(</span><span class="n">cln</span><span class="p">,</span> <span class="n">p_min_thresh</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">p_max_thresh</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">samples_per_peak</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Run Lomb-Scargle periodogram and return a dictionary of results.</span>

<span class="sd">    .. _dict: https://docs.python.org/3/tutorial/datastructures.html#dictionaries</span>
<span class="sd">    .. |dict| replace:: **dict**</span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _int: https://docs.python.org/3/library/functions.html#int</span>
<span class="sd">    .. |int| replace:: **int** </span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cln : |dict|_</span>
<span class="sd">        A dictionary containing the lightcurve data. The keys must include</span>
<span class="sd">        | &quot;time0&quot; -&gt; The time coordinate relative to the first data point</span>
<span class="sd">        | &quot;nflux&quot; -&gt; The detrended, cleaned, normalised flux values</span>
<span class="sd">    p_min_thresh : |float|_, optional, default=0.05</span>
<span class="sd">        The minimum period (in days) to be calculated.</span>
<span class="sd">    p_max_thresh : |float|_, optional, default=100.</span>
<span class="sd">        The maximum period (in days) to be calculated.</span>
<span class="sd">    samples_per_peak : |int|_, optional, default=10</span>
<span class="sd">        The number of samples to measure in each periodogram peak.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    LS_dict : |dict|_</span>
<span class="sd">        A dictionary of parameters calculated from the periodogram analysis</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">LS_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">med_f</span><span class="p">,</span> <span class="n">MAD_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">]),</span> <span class="n">MAD</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">LombScargle</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time0&quot;</span><span class="p">],</span> <span class="n">cln</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">])</span>
    <span class="n">frequency</span><span class="p">,</span> <span class="n">power</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">autopower</span><span class="p">(</span><span class="n">minimum_frequency</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">p_max_thresh</span><span class="p">,</span>
                                    <span class="n">maximum_frequency</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">p_min_thresh</span><span class="p">,</span>
                                    <span class="n">samples_per_peak</span><span class="o">=</span><span class="n">samples_per_peak</span><span class="p">)</span>
    <span class="n">FAP</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">false_alarm_probability</span><span class="p">(</span><span class="n">power</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">FAP_test</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">false_alarm_level</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
    <span class="n">p_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
    <span class="n">y_fit</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time0&quot;</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="n">p_m</span><span class="p">])</span>
    <span class="n">period_best</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">frequency</span><span class="p">[</span><span class="n">p_m</span><span class="p">]</span>
    <span class="n">power_best</span> <span class="o">=</span> <span class="n">power</span><span class="p">[</span><span class="n">p_m</span><span class="p">]</span>

    <span class="n">period</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">frequency</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">power</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># a_g: array of datapoints that form the Gaussian around the highest power</span>
    <span class="c1"># a_o: the array for all other datapoints</span>
    <span class="n">a_g</span><span class="p">,</span> <span class="n">a_o</span> <span class="o">=</span> <span class="n">get_second_peak</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">popt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">gauss_fit</span><span class="p">,</span> <span class="n">period</span><span class="p">[</span><span class="n">a_g</span><span class="p">],</span> <span class="n">power</span><span class="p">[</span><span class="n">a_g</span><span class="p">],</span>
                            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="n">p_max_thresh</span><span class="p">,</span> <span class="n">p_max_thresh</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span>
        <span class="n">popt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_max_thresh</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p_max_thresh</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">pass</span>

    <span class="n">ym</span> <span class="o">=</span> <span class="n">gauss_fit</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">a_g</span><span class="p">],</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>
    <span class="n">per_a_o</span><span class="p">,</span> <span class="n">power_a_o</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="n">a_o</span><span class="p">],</span> <span class="n">power</span><span class="p">[</span><span class="n">a_o</span><span class="p">]</span>
    <span class="n">per_2</span> <span class="o">=</span> <span class="n">per_a_o</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">a_o</span><span class="p">])]</span>
    <span class="n">pow_2</span> <span class="o">=</span> <span class="n">power_a_o</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">a_o</span><span class="p">])]</span>
    <span class="n">pow_pow2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">power_best</span><span class="o">/</span><span class="n">pow_2</span>
    <span class="n">tdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time0&quot;</span><span class="p">]</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;time0&quot;</span><span class="p">]))</span>
    <span class="n">nflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cln</span><span class="p">[</span><span class="s2">&quot;nflux&quot;</span><span class="p">])</span>
    <span class="n">pha</span><span class="p">,</span> <span class="n">cyc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">modf</span><span class="p">(</span><span class="n">tdiff</span><span class="o">/</span><span class="n">period_best</span><span class="p">)</span>
    <span class="n">pha</span><span class="p">,</span> <span class="n">cyc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pha</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tdiff</span><span class="o">/</span><span class="n">period_best</span><span class="p">)</span>
    <span class="n">pha_fit</span><span class="p">,</span> <span class="n">nf_fit</span><span class="p">,</span> <span class="n">cyc_fit</span> <span class="o">=</span> <span class="n">pha</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">nflux</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">cyc</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">pha_plt</span><span class="p">,</span> <span class="n">nf_plt</span><span class="p">,</span> <span class="n">cyc_plt</span> <span class="o">=</span> <span class="n">pha</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">nflux</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">cyc</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pops</span><span class="p">,</span> <span class="n">popsc</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">sine_fit</span><span class="p">,</span> <span class="n">pha_fit</span><span class="p">,</span> <span class="n">nf_fit</span><span class="p">,</span>
                                <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span>
        <span class="n">pops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="k">pass</span>
            
    <span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cln</span><span class="p">)</span>
    <span class="n">yp</span> <span class="o">=</span> <span class="n">sine_fit</span><span class="p">(</span><span class="n">pha_fit</span><span class="p">,</span> <span class="o">*</span><span class="n">pops</span><span class="p">)</span>
    <span class="n">pha_sct</span> <span class="o">=</span> <span class="n">MAD</span><span class="p">(</span><span class="n">yp</span> <span class="o">-</span> <span class="n">nflux</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">fdev</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">nflux</span> <span class="o">-</span> <span class="n">yp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">pha_sct</span><span class="p">)</span><span class="o">/</span><span class="n">Ndata</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;median_MAD_nLC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">med_f</span><span class="p">,</span> <span class="n">MAD_f</span><span class="p">]</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;period_best&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_best</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;power_best&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power_best</span> 
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;y_fit_LS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_fit</span> 
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;FAPs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FAP_test</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;Gauss_fit_peak_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;Gauss_fit_peak_y_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ym</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;period_around_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="n">a_g</span><span class="p">]</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;power_around_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span><span class="p">[</span><span class="n">a_g</span><span class="p">]</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;period_not_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="n">a_o</span><span class="p">]</span> 
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;power_not_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span><span class="p">[</span><span class="n">a_o</span><span class="p">]</span> 
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;period_second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_2</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;power_second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pow_2</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_fit_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pha_fit</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_fit_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yp</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pha_plt</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nf_plt</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyc_plt</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;pops_vals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pops</span>    
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;pops_cov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popsc</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;phase_scatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pha_sct</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;frac_phase_outliers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdev</span>
    <span class="n">LS_dict</span><span class="p">[</span><span class="s1">&#39;Ndata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ndata</span>
    <span class="k">return</span> <span class="n">LS_dict</span></div>
    
    
<div class="viewcode-block" id="is_period_cont"><a class="viewcode-back" href="../../api/tessilator.lc_analysis.is_period_cont.html#tessilator.lc_analysis.is_period_cont">[docs]</a><span class="k">def</span> <span class="nf">is_period_cont</span><span class="p">(</span><span class="n">d_target</span><span class="p">,</span> <span class="n">d_cont</span><span class="p">,</span> <span class="n">t_cont</span><span class="p">,</span> <span class="n">frac_amp_cont</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Identify neighbouring contaminants that may cause the periodicity.</span>

<span class="sd">    .. _dict: https://docs.python.org/3/tutorial/datastructures.html#dictionaries</span>
<span class="sd">    .. |dict| replace:: **dict**</span>
<span class="sd">    .. _astropy.table.Table: https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.timeseries.Table</span>
<span class="sd">    .. |astropy.table.Table| replace:: **astropy.table.Table** </span>
<span class="sd">    .. _float: https://docs.python.org/3/library/functions.html#float</span>
<span class="sd">    .. |float| replace:: **float**</span>
<span class="sd">    .. _str: https://docs.python.org/3/library/stdtypes.html#str</span>
<span class="sd">    .. |str| replace:: **str**</span>

<span class="sd">    If the user selects to measure periods for the neighbouring contaminants</span>
<span class="sd">    this function returns a flag to assess if a contaminant may actually be</span>
<span class="sd">    the source causing the observed periodicity.</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d_target : |dict|_</span>
<span class="sd">        A dictionary containing periodogram data of the target star.</span>
<span class="sd">    d_cont : |dict|_</span>
<span class="sd">        A dictionary containing periodogram data of the contaminant star.</span>
<span class="sd">    t_cont : |astropy.table.Table|_</span>
<span class="sd">        A table containing Gaia data for the contaminant star</span>
<span class="sd">    frac_amp_cont : |float|_, optional, default=0.5</span>
<span class="sd">        The threshold factor to account for the difference in amplitude</span>
<span class="sd">        of the two stars. If this is high, then the contaminants will be</span>
<span class="sd">        less likely to be flagged as the potential source</span>
<span class="sd">    </span>
<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    output : |str|_</span>
<span class="sd">        | Either `a&#39;, `b&#39; or `c&#39;</span>
<span class="sd">        | (a) The contaminant is probably the source causing the periodicity</span>
<span class="sd">        | (b) The contaminant might be the source causing the periodicity</span>
<span class="sd">        | (c) The contaminant is not the source causing the periodicity</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">per_targ</span> <span class="o">=</span> <span class="n">d_target</span><span class="p">[</span><span class="s2">&quot;period_best&quot;</span><span class="p">]</span>
    <span class="n">per_cont</span> <span class="o">=</span> <span class="n">d_cont</span><span class="p">[</span><span class="s2">&quot;period_best&quot;</span><span class="p">]</span>
    <span class="n">err_targ</span> <span class="o">=</span> <span class="n">d_target</span><span class="p">[</span><span class="s2">&quot;Gauss_fit_peak_parameters&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">err_cont</span> <span class="o">=</span> <span class="n">d_cont</span><span class="p">[</span><span class="s2">&quot;Gauss_fit_peak_parameters&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">amp_targ</span> <span class="o">=</span> <span class="n">d_target</span><span class="p">[</span><span class="s2">&quot;pops_vals&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">amp_cont</span> <span class="o">=</span> <span class="n">d_cont</span><span class="p">[</span><span class="s2">&quot;pops_vals&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">flux_frac</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">t_cont</span><span class="p">[</span><span class="s2">&quot;log_flux_frac&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">per_targ</span> <span class="o">-</span> <span class="n">per_cont</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">err_targ</span> <span class="o">+</span> <span class="n">err_cont</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">amp_targ</span><span class="o">/</span><span class="n">amp_cont</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">frac_amp_cont</span><span class="o">*</span><span class="n">flux_frac</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
    <span class="k">return</span> <span class="n">output</span></div>


</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">tessilator 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">tessilator.lc_analysis</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Alex Binks &amp; Moritz Guenther.
      Last updated on 16 Mar 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>